---
import SiteLayout from "../layouts/SiteLayout.astro";
import { getEntry } from "astro:content";
import GithubActivityCard from "../components/GithubActivityCard.astro";

const homepageEntry = await getEntry("homepage", "dashboard");
const heroCards = homepageEntry.data.highlightCards;
const nowItems = homepageEntry.data.nowItems;
const timeline = homepageEntry.data.timeline;

const homepageSchema = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "@id": "https://www.nbdevlab.com/#home",
  name: "nbdevlab — Home",
  description:
    "Builder notes, experiments, and shipped tools from Nathan Bullock. Track projects, lab milestones, and GitHub activity in one view.",
  url: "https://www.nbdevlab.com/",
  isPartOf: { "@id": "https://www.nbdevlab.com/#website" },
};
---
<SiteLayout
  title="nbdevlab — Builder notes and experiments"
  description="Builder notes, project milestones, and GitHub activity from Nathan Bullock's nbdevlab."
  structuredData={homepageSchema}
>
  <section class="hero" aria-labelledby="home-hero-heading">
    <div class="hero__title-group">
      <span class="badge" aria-hidden="true">Edge-native lab</span>
      <h1 id="home-hero-heading">Automation, homelab, and UI co-designed with AI</h1>
      <p class="lede">
        I’m Nathan Bullock — building nbdevlab as an always-on workshop for OpenAI-powered tooling, Cloudflare automations, and homelab
        resilience. This is the control panel: highlights, milestones, and the signals that keep the lab humming.
      </p>
      <div class="hero__ctas">
        <a class="button button--primary" href="/projects/">Explore projects</a>
        <a class="button button--ghost" href="/about/">Meet Nathan</a>
      </div>
      <div class="chip-row" role="list">
        {[
          "Cloudflare Pages",
          "Astro",
          "OpenAI Codex",
          "Homelab",
          "Automation",
        ].map((item) => (
          <span class="tag-chip" role="listitem">
            <span aria-hidden="true"></span>
            {item}
          </span>
        ))}
      </div>
    </div>
    <aside aria-label="Recent terminal activity" class="card" style="background: var(--color-surface-alt);">
      <h2 class="card__title">Latest deployment trace</h2>
      <pre aria-label="Recent commands" role="log">
nbullock@homelab:~/lab main
➜ git pull --rebase origin main
Already up to date.
➜ npm run sync
content collections refreshed
➜ npm run build
✓ deployed to Cloudflare Pages
      </pre>
    </aside>
  </section>

  <section aria-labelledby="dash-heading" style="margin-top: clamp(2.5rem, 6vw, 4rem);">
    <header>
      <h2 id="dash-heading">Lab dashboard</h2>
      <p class="lede">Pinned workstreams, roadmap beats, and the GitHub feed that powers nbdevlab’s daily cadence.</p>
    </header>
    <div class="card-grid" role="list">
      {heroCards.map((card) => (
        <a
          role="listitem"
          class="card"
          href={card.href}
          style={`--card-accent: ${card.accent ?? "194 65 12"};`}
        >
          <span class="card__meta">{card.badge}</span>
          <h3 class="card__title">{card.title}</h3>
          <p>{card.description}</p>
          <div class="card__footer">
            <span>Open</span>
            <span aria-hidden="true">↗</span>
          </div>
        </a>
      ))}
      <article class="github-card" role="listitem">
        <GithubActivityCard limit={5} />
      </article>
    </div>
  </section>

  <section aria-labelledby="timeline-heading" style="margin-top: clamp(3rem, 6vw, 4.5rem);">
    <header>
      <h2 id="timeline-heading">Milestones &amp; notes</h2>
      <p class="lede">A running log of the experiments and releases shaping nbdevlab.</p>
    </header>
    {timeline.length > 0 ? (
      <ol class="timeline" role="list">
        {timeline.map((item) => (
          <li class="timeline__item" role="listitem">
            <p class="timestamp">{item.date}</p>
            <h3>{item.title}</h3>
            <p>{item.detail}</p>
          </li>
        ))}
      </ol>
    ) : (
      <div class="projects-empty" role="status">Milestones are drafting — check back soon.</div>
    )}
  </section>

  <section aria-labelledby="now-heading" style="margin-top: clamp(3rem, 6vw, 4.5rem);">
    <header>
      <h2 id="now-heading">What’s in focus right now</h2>
      <p class="lede">A snapshot of the initiatives and instrumentation keeping the lab on track.</p>
    </header>
    {nowItems.length > 0 ? (
      <div class="now-card-grid" role="list">
        {nowItems.map((item) => (
          <article class="now-card" role="listitem">
            <div class="now-card__icon" aria-hidden="true">⚙️</div>
            <h3 class="card__title">{item.label}</h3>
            <p>{item.detail}</p>
          </article>
        ))}
      </div>
    ) : (
      <div class="projects-empty" role="status">Focus areas will refresh shortly.</div>
    )}
  </section>
</SiteLayout>
